<html>
<body>

<style type="text/css">
.FR {
	float:right;
}
.FL {
	float:left;
}
.labelTextInput {
	display:block;
	font-size:8pt;
}
h1, h1 span {
	font-size:10pt;
	font-weight:bold;
}
#validation_msg {
	font-style:italic;
}
p, span, body {
	font-family: Verdana, Arial;
	font-size:10pt;
}
label {
	cursor:pointer;
}
</style>

<script type="text/javascript" src="jquery.js"></script>

<div id="pwdhashEnabled">
	<h1>
		<img src="images/icon16.png"/>
		<span>Settings for</span>
		<span id="domainTitle"></span>
	</h1>
	<form id="pwdhash_menu" style="width:250px;">
	<p><label for="domain" class="labelTextInput">Use an alternative domain</label>
		<input type="text" id="domain" value="" /></p>
	
	<!--
	<p><input type="checkbox" id="alertPwd" />
		<label for="alertPwd">Prompt password and hash</label></p>
	<p><input type="checkbox" id="noIntercept" />
		<label for="noIntercept">Disable interception security</label></p>
	-->
	
	<input type="button" value="Options" onclick="chrome.tabs.create({url: 'options.html'});" />
	<center style="display:none">
		<p id="validation_msg"/></p>
		<input type="button" id="validate" value="Save changes" />
	</center>
	</form>
</div>

<div id="pwdhashDisabled" style="width:200px">
	PwdHash is not active.
</div>

<script type="text/javascript">
(function () {

var $P = function (id) {
	var o = new (function (e) {
		this.htmlElement = e;
		this.click = function (fn) { e.addEventListener('click', fn); return o; };
		this.blur = function (fn) { e.addEventListener('blur', fn); return o; };
		this.keyup = function (fn) { e.addEventListener('keyup', fn); return o; };
		this.html = function (a1) {
			e.innerHTML = a1;
		}
		this.val = function (a1) {
			if (a1 == undefined) {
				if (e.type == 'checkbox')
					return e.checked; 
					else return e.value; 
			}
			if (e.type == 'checkbox') {
				e.checked = a1;
			}
				else e.value = a1;
			
			return o;
		};
	})(document.getElementById(id));
	return o;
};

$('#pwdhashEnabled').hide();
$('#pwdhashDisabled').show();

var sendRequest = function (params, callback) {
	chrome.tabs.getSelected(null, function(tab) {
		chrome.tabs.sendRequest(tab.id, params, callback);
	});
};

var old_domain;

sendRequest({controller: 'AlternativeDomain', action: "getDomain"}, function(response) {
	$('#domain').val(response.domain);
	old_domain = response.domain;
	
	$('#domainTitle').html(response.defaultDomain);
	$('#pwdhashEnabled').show();
	$('#pwdhashDisabled').hide();
});

var save_domain = function () {
	sendRequest({controller: 'AlternativeDomain',
		action: "setDomain",
		domain: $('#domain').val()}
	, function () {
		old_domain = $('#domain').val();
	});
};

$('#domain').keyup(function () {
	if (old_domain != $('#domain').val()) {
		save_domain();
	}
});

/*
var init_setting = function (k) {
	old[k] = false;
	try {
		old[k] = chrome.extension.getBackgroundPage().settings.retrieve(k);
	} catch (e) {
		console.error('init_setting error');
	}
	$P(k).val(old[k] ? true:false);
	$P(k).click(function () {
		chrome.extension.getBackgroundPage().settings.store(k, $P(k).val());
	});
};

var old = {};
var settings_send = {};
var settings = ['alertPwd', 'noIntercept'];
for (var k in settings) {
	init_setting(settings[k]);
}

*/

/*
$('#validate').click(function () {
	if (old_domain != $('#domain').val()) {
		save_domain();
	}
	for (var k in settings_send) {
		settings_send[k]();
	}
	$('#validation_msg').htmlElement.innerHTML = 'New settings saved !';
	window.setTimeout(function () { $('#validation_msg').htmlElement.innerHTML = ''; }, 2000);
});
*/

})();
</script>

</body>
</html>